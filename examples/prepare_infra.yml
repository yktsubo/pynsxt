env:
  nsxManager:
    ip: '192.168.172.39'
    username: 'admin'    
    password: 'VMware1!' 
  # nsxController:
  #   - ip: '192.168.110.51'    
  #     username: 'admin'    
  #     password: 'VMware1!'
  #     secret: 'VMware1!'
  # nsxEdge:
  #   - ip: '192.168.110.41'
  #     username: 'admin'    
  #     password: 'VMware1!' 
      
# action: create,update,delete
tasks:
  # - module: 'Controller'
  #   action: 'join_manager'
  # - module: 'Edge'
  #   action: 'join_manager'
  # - module: 'Controller'
  #   action: 'initialize'
  - module: 'IPPool'
    action: 'create'
    data:
      display_name: 'tep-for-esxi'
      subnets:
        - allocation_ranges:
            - start: '192.168.140.151'
              end: '192.168.140.160'
          cidr: '192.168.140.0/24'
          gateway_ip: '192.168.140.1'
  - module: 'IPPool'
    action: 'create'
    data:
      display_name: 'tep-for-kvm'
      subnets:
        - allocation_ranges:
            - start: '192.168.150.151'
              end: '192.168.150.160'
          cidr: '192.168.150.0/24'
          gateway_ip: '192.168.150.1'
  - module: 'TransportZone'
    action: 'create'
    data:
      display_name: 'OverlayTZ'
      host_switch_mode: 'STANDARD'
      host_switch_name: 'overlayNVDS'
      transport_type: 'OVERLAY'
  - module: 'TransportZone'
    action: 'create'
    data:
      display_name: 'VlanTZ'
      host_switch_mode: 'STANDARD'
      host_switch_name: 'vlanNVDS'
      transport_type: 'VLAN'
  # - module: 'HostNode'
  #   action: 'create'
  #   data:
  #     display_name: 'esxcomp-01a.corp.local'
  #     os_type: 'ESXI'
  #     ip: '192.168.120.151'
  #     username: 'root'
  #     password: 'VMware1!'
  # - module: 'HostNode'
  #   action: 'create'
  #   data:
  #     display_name: 'esxcomp-02a.corp.local'      
  #     os_type: 'ESXI'
  #     ip: '192.168.120.152'
  #     username: 'root'
  #     password: 'VMware1!'
  - module: 'UplinkProfile'
    action: 'create'
    data:
      display_name: 'esxi-profile'
      mtu: 1600
      transport_vlan: 0
      active_uplink:
        - 'uplink0'
      teaming_policy: 'FAILOVER_ORDER'

  - module: 'UplinkProfile'
    action: 'create'
    data:
      display_name: 'edge-profile'
      mtu: 1600
      transport_vlan: 0
      active_uplink:
        - 'uplink0'
      teaming_policy: 'FAILOVER_ORDER'

  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'esxcomp-01a.corp.local'
      node: 'esxcomp-01a.corp.local'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'esxi-profile'
          uplink_mapping:
            uplink0: 'vmnic1'
          ip_assignment:
            ippool: 'tep-for-esxi'

  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'esxcomp-02a.corp.local'
      node: 'esxcomp-02a.corp.local'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'esxi-profile'
          uplink_mapping:
            uplink0: 'vmnic1'
          ip_assignment:
            ippool: 'tep-for-esxi'
            
  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'nsxedge-01a'
      node: 'nsxedge-01a'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth0'
          ip_assignment:
            ippool: 'tep-for-esxi'
        - tz: 'VlanTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth1'

  - module: 'TransportNode'
    action: 'create'
    data:
      display_name: 'nsxedge-02a'
      node: 'nsxedge-02a'
      nvds:
        - tz: 'OverlayTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth0'
          ip_assignment:
            ippool: 'tep-for-esxi'
        - tz: 'VlanTZ'
          uplink_profile: 'edge-profile'
          uplink_mapping:
            uplink0: 'fp-eth1'
          
  - module: 'EdgeCluster'
    action: 'create'
    data:
      display_name: 'EdgeCluster1'
      members:
        - 'nsxedge-01a'
